<!doctype html>
<html>
<head>
<!--<script type="text/javascript" src="http://www.java.com/js/deployJava.js"></script>-->
<script>
/**
 * Provides requestAnimationFrame in a cross browser way.
 * http://paulirish.com/2011/requestanimationframe-for-smart-animating/
 */
if ( !window.requestAnimationFrame ) {
	window.requestAnimationFrame = (function() {
		return window.webkitRequestAnimationFrame ||
		window.mozRequestAnimationFrame ||
		window.oRequestAnimationFrame ||
		window.msRequestAnimationFrame ||
		function( /* function FrameRequestCallback */ callback, /* DOMElement Element */ element ) {
			window.setTimeout( callback, 1000 / 60 );
		};
	})();
}
</script>
</head>
<body>
<!--<script>
/*deployJava.runApplet({
		code:		'img_applet.ImgApplet.class',
		archive:	'img-applet.jar',
		width:		100,
		height:	40
	}, {
		rtmp:		'rtmp://localhost/rtmp/webcam'
	});*/
script>-->
<embed id="img-applet"
       type="application/x-java-applet"
       width="100" height="40" 
       archive="img-applet.jar"
       code="img_applet.ImgApplet"
       pluginspage="http://java.com/download/"
       rtmp="rtmp://localhost/rtmp/webcam" />

<img id="image" width="320" height="240" style="visibility: hidden; display: none;"></img>
<br />
<canvas id="videoImage" width="320" height="240" style="visibility: visible;"></canvas>

<script>

// global variables
var image, videoImage, videoImageContext, applet, sn = 0;

// assign variables to HTML elements
image = document.getElementById( 'image' );
videoImage = document.getElementById( 'videoImage' );
videoImageContext = videoImage.getContext( '2d' );
applet = document.getElementById( 'img-applet' );

// background color if no video present
videoImageContext.fillStyle = '#005337';
videoImageContext.fillRect( 0, 0, videoImage.width, videoImage.height );				

image.onload = function() {
	videoImageContext.drawImage( image, 0, 0, videoImage.width, videoImage.height );
};

// start the loop				
animate();

function animate() {
	requestAnimationFrame( animate );
	render();		
}

function render() {
	var sn_ = applet.getSN();
	if ( sn_ > sn ) {
		sn = sn_;
		image.src = applet.getDataURI();
	}
}

</script>

</body>
</html>